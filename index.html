<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- å…³é”®ï¼šç¦æ­¢ç”¨æˆ·ç¼©æ”¾é¡µé¢æ–‡å­—ï¼Œä½†å…è®¸ç¼©æ”¾D3ç”»å¸ƒï¼Œé€‚é…ç§»åŠ¨ç«¯è§†å£ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç†è®ºåŠ›å­¦å¤ä¹  - ç§»åŠ¨ä¼˜åŒ–ç‰ˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- å…¨å±€åŸºç¡€æ ·å¼ --- */
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
            overflow: hidden; 
            background-color: #f4f6f9; 
            display: flex; 
            height: 100vh; /* å¼ºåˆ¶å æ»¡å±å¹• */
            width: 100vw;
        }

        /* --- å·¦ä¾§ç”»å¸ƒå®¹å™¨ --- */
        #graph-container { 
            width: 65%; 
            height: 100%; 
            background-color: #ffffff; 
            position: relative; 
            /* é˜²æ­¢ç§»åŠ¨ç«¯ä¸‹æ‹‰åˆ·æ–°å¹²æ‰° */
            overscroll-behavior: none; 
            touch-action: none; 
        }

        /* --- å³ä¾§/åº•éƒ¨ä¿¡æ¯é¢æ¿ --- */
        #info-panel { 
            width: 35%; 
            height: 100%; 
            padding: 30px; 
            box-sizing: border-box; 
            overflow-y: auto; 
            background-color: #fbfbfb; 
            box-shadow: -5px 0 15px rgba(0,0,0,0.05); 
            position: relative;
            z-index: 100;
            transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        /* å…³é—­æŒ‰é’® (ä»…åœ¨ç§»åŠ¨ç«¯æ˜¾ç¤ºï¼Œé»˜è®¤éšè—) */
        .close-btn {
            display: none;
            position: absolute;
            top: 15px;
            right: 15px;
            background: #eee;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 18px;
            color: #555;
            cursor: pointer;
            z-index: 101;
        }

        /* --- å“åº”å¼å¸ƒå±€ (Mobile Layout) --- */
        @media (max-width: 768px) {
            body { flex-direction: column; }
            
            #graph-container { 
                width: 100%; 
                height: 100%; /* æ‰‹æœºä¸Šåœ°å›¾å…¨å± */
            }

            #info-panel { 
                position: fixed; /* æ‚¬æµ®åœ¨ä¸Šæ–¹ */
                bottom: 0; 
                left: 0; 
                width: 100%; 
                height: 75%; /* å æ®å±å¹•é«˜åº¦çš„75% */
                width: 100vw;
                border-radius: 20px 20px 0 0; /* é¡¶éƒ¨åœ†è§’ */
                box-shadow: 0 -5px 30px rgba(0,0,0,0.15);
                transform: translateY(110%); /* é»˜è®¤éšè—åœ¨åº•éƒ¨ */
                padding: 20px;
                padding-top: 50px; /* ç»™å…³é—­æŒ‰é’®ç•™ç©ºé—´ */
            }

            #info-panel.active {
                transform: translateY(0); /* æ¿€æ´»æ—¶æ»‘ä¸Šæ¥ */
            }

            .close-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .legend {
                font-size: 0.8em;
                padding: 10px;
                max-width: 180px;
                top: 10px;
                left: 10px;
            }
        }

        /* --- å†…å®¹æ ·å¼ä¼˜åŒ– --- */
        h2 { color: #1a237e; border-bottom: 3px solid #3949ab; padding-bottom: 15px; margin-top: 0; font-size: 1.5em; }
        h3 { color: #283593; margin-top: 20px; font-size: 1.3em; display: flex; align-items: center; flex-wrap: wrap; gap: 8px;}
        .tag { font-size: 0.6em; color: #fff; padding: 4px 8px; border-radius: 12px; font-weight: normal; white-space: nowrap;}
        
        /* æ¿å—é€šç”¨æ ·å¼ */
        .content-box { margin-bottom: 15px; border-radius: 8px; padding: 12px; font-size: 0.95em; line-height: 1.6; }
        
        .logic-box { background-color: #e8eaf6; border: 1px solid #c5cae9; }
        .logic-title { color: #303f9f; font-weight: bold; display: block; margin-bottom: 5px; }
        
        .eng-box { background-color: #e0f2f1; border: 1px solid #b2dfdb; }
        .eng-title { color: #00695c; font-weight: bold; display: block; margin-bottom: 5px; }

        .formula-box { background-color: #fff3e0; border: 1px dashed #ff9800; font-family: "Courier New", monospace; color: #bf360c; }
        .formula-title { color: #e65100; font-weight: bold; display: block; font-family: sans-serif; margin-bottom: 5px; }

        .knowledge-ref { background-color: #e3f2fd; border-left: 5px solid #2196f3; padding: 15px; margin-top: 20px; font-size: 0.95em; color: #0d47a1; }
        .knowledge-list { padding-left: 20px; margin: 5px 0; }
        
        /* ç‰©ç†é‡è¡¨æ ¼ */
        .unit-box { margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; background: white; }
        .unit-title { background: #f5f5f5; padding: 10px; font-weight: bold; color: #333; font-size: 0.9em; border-bottom: 1px solid #ddd; }
        .soul-quote { display: block; font-size: 0.8em; color: #777; font-style: italic; margin-top: 4px; font-weight: normal; }
        .unit-table { width: 100%; border-collapse: collapse; font-size: 0.85em; }
        .unit-table th, .unit-table td { padding: 8px; border-bottom: 1px solid #eee; text-align: left; }
        .unit-table th { background: #fafafa; color: #666; }
        .unit-table code { background: #f0f2f5; padding: 2px 5px; border-radius: 3px; color: #c0392b; font-family: monospace; }

        /* Fun Fact */
        .fun-fact-box { background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%); border: 1px solid #fdd835; padding: 15px; border-radius: 8px; margin-top: 20px; }
        .fun-fact-title { color: #f57f17; font-weight: bold; display: flex; align-items: center; margin-bottom: 8px; }
        .fun-fact-content { color: #795548; font-size: 0.9em; }

        /* D3 å…ƒç´  */
        .node circle { stroke: #fff; stroke-width: 3px; cursor: pointer; transition: all 0.3s; }
        .node text { font-size: 14px; pointer-events: none; text-anchor: middle; font-family: sans-serif; font-weight: bold; fill: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.6); }
        .link { stroke: #b0bec5; stroke-opacity: 0.6; stroke-width: 2px; }
        .link.source-Fma { stroke: #ff7043; stroke-dasharray: 6,3; } 
        .link.synthesis { stroke: #7b1fa2; stroke-width: 3px; }
        
        .legend { position: absolute; top: 20px; left: 20px; background: rgba(255,255,255,0.95); padding: 12px; border-radius: 10px; border: 1px solid #eee; box-shadow: 0 4px 12px rgba(0,0,0,0.1); pointer-events: none; }
        .dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; margin-right: 8px; }
    </style>
</head>
<body>

<div id="graph-container">
    <div class="legend">
        <div style="font-weight:bold; margin-bottom:5px; color:#555;">çŸ¥è¯†ä½“ç³»</div>
        <div><span class="dot" style="background:#d32f2f"></span>æ ¸å¿ƒåŸç†</div>
        <div><span class="dot" style="background:#f57c00"></span>é™åŠ›å­¦</div>
        <div><span class="dot" style="background:#1976d2"></span>è¿åŠ¨å­¦</div>
        <div><span class="dot" style="background:#388e3c"></span>åŠ¨åŠ›å­¦</div>
    </div>
</div>

<div id="info-panel">
    <button class="close-btn" onclick="closePanel()"><i class="fas fa-times"></i></button>
    <div id="panel-inner">
        <h2>ç†è®ºåŠ›å­¦ Â· æ·±åº¦å¤ä¹ </h2>
        <p style="color:#666; font-size:0.9em;">ğŸ‘‡ ç‚¹å‡»å›¾ä¸­çš„åœ†åœˆèŠ‚ç‚¹ï¼ŒæŸ¥çœ‹å…¬å¼ã€é‡çº²ä¸å·¥ç¨‹èƒŒæ™¯ã€‚</p>
        <div id="details-content" style="margin-top: 50px; text-align: center; color: #999;">
            <i class="fas fa-hand-pointer fa-2x"></i><br><br>
            è¯·ç‚¹å‡»èŠ‚ç‚¹å¼€å§‹å¤ä¹ 
        </div>
    </div>
</div>

<script>
    // --- æ•°æ®å®šä¹‰ ---
    const data = {
        nodes: [
            // æ ¸å¿ƒ
            { id: "ç‰›é¡¿ç¬¬äºŒå®šå¾‹ (F=ma)", group: 0, 
                desc: "ç»å…¸åŠ›å­¦æ ¸å¿ƒã€‚åŠ›ä¸è¿åŠ¨çš„å› æœå…³ç³»ã€‚", 
                logic: "ã€æ ¸å¿ƒåˆæˆã€‘åŠ›ç³»ç®€åŒ–(F) + åˆšä½“å¹³é¢è¿åŠ¨(a) => åŠ¨åŠ›å­¦æ–¹ç¨‹ã€‚",
                formula: "âˆ‘F = ma<br>M_c = J_cÂ·Î±",
                eng: "æœºæ¢°è®¾è®¡ï¼ˆå¼ºåº¦æ ¡æ ¸ï¼‰ã€æŒ¯åŠ¨åˆ†æï¼ˆå…±æŒ¯é¢„é˜²ï¼‰ã€è‡ªåŠ¨æ§åˆ¶ï¼ˆPIDç®—æ³•ï¼‰çš„ç†è®ºåŸºçŸ³ã€‚",
                points: ["åŠ›ä¸è¿åŠ¨å…³ç³»", "å†²é‡æ¦‚å¿µ", "è´¨ç‚¹ç³»åº”ç”¨"],
                units: [{name:"åŠ›",sym:"F",unit:"N",dim:"MLTâ»Â²"}, {name:"è´¨é‡",sym:"m",unit:"kg",dim:"M"}, {name:"åŠ é€Ÿåº¦",sym:"a",unit:"m/sÂ²",dim:"LTâ»Â²"}],
                funFact: "ç‰›é¡¿æœ€åˆå¹¶éå†™ F=maï¼Œè€Œæ˜¯ F=dp/dtï¼ˆåŠ¨é‡å˜åŒ–ç‡ï¼‰ã€‚F=ma æ˜¯ç”±æ¬§æ‹‰åæ¥æ•´ç†æ¨å¹¿çš„ç®€æ´å½¢å¼ã€‚"
            },
            // é™åŠ›å­¦
            { id: "å—åŠ›åˆ†æ (FBD)", group: 1, 
                desc: "è§£é™¤çº¦æŸï¼Œç”»å‡ºåˆ†ç¦»ä½“å›¾ã€‚", 
                logic: "é™åŠ›å­¦çš„åŸºç¡€ï¼Œä¹Ÿæ˜¯åŠ¨åŠ›å­¦çš„åŸºç¡€ã€‚", 
                formula: "G=mg, F_fâ‰¤Î¼F_N",
                eng: "å·¥ç¨‹äº‹æ•…åˆ†æçš„ç¬¬ä¸€æ­¥ã€‚å¿…é¡»å°†é›¶ä»¶ä»å¤æ‚ç³»ç»Ÿä¸­â€œéš”ç¦»â€å‡ºæ¥å•ç‹¬åˆ†æã€‚",
                points: ["äºŒåŠ›å¹³è¡¡å…¬ç†", "æŸ”æ€§çº¦æŸ", "ä½œç”¨ä¸åä½œç”¨"],
                units: [{name:"é‡åŠ›",sym:"G",unit:"N",dim:"MLTâ»Â²"}, {name:"çº¦æŸåŠ›",sym:"F_N",unit:"N",dim:"MLTâ»Â²"}],
                funFact: "â€œæ³•å‘çº¦æŸåŠ›â€åœ¨å¾®è§‚ä¸Šå…¶å®æ˜¯åŸå­å¤–å±‚ç”µå­äº‘ä¹‹é—´çš„ç”µç£æ’æ–¥åŠ›ã€‚"
            },
            { id: "åŠ›ç³»ç®€åŒ–", group: 1, 
                desc: "å¤æ‚åŠ›ç³» => ä¸»çŸ¢ + ä¸»çŸ©ã€‚", 
                logic: "ç®€åŒ–çš„ç»“æœå†³å®šåˆšä½“æ˜¯å¹³åŠ¨ï¼ˆä¸»çŸ¢ï¼‰è¿˜æ˜¯è½¬åŠ¨ï¼ˆä¸»çŸ©ï¼‰ã€‚", 
                formula: "F_R'=âˆ‘F_i<br>M_O=âˆ‘M_O(F)",
                eng: "æœ‰é™å…ƒåˆ†æä¸­çš„è½½è·ç®€åŒ–ï¼›èˆ¹èˆ¶ç¨³å®šæ€§è®¡ç®—ï¼ˆé˜²å€¾è¦†ï¼‰ã€‚",
                points: ["åŠ›å¹³ç§»å®šç†", "ç®€åŒ–ç»“æœåˆ†æ", "åŠ›å¶æ€§è´¨"],
                units: [{name:"ä¸»çŸ¢",sym:"F_R",unit:"N",dim:"MLTâ»Â²"}, {name:"ä¸»çŸ©",sym:"M_O",unit:"NÂ·m",dim:"MLÂ²Tâ»Â²"}],
                funFact: "åŠ›å¶åœ¨ç©ºé—´ä¸­æ˜¯â€œè‡ªç”±â€çš„çŸ¢é‡ï¼Œç§»åŠ¨ä¸æ”¹å˜å…¶æ•ˆåº”ï¼Œçº¯ç²¹äº§ç”Ÿè½¬åŠ¨ã€‚"
            },
            { id: "é™åŠ›å­¦å¹³è¡¡æ–¹ç¨‹", group: 1, 
                desc: "Î£F=0, Î£M=0ã€‚", 
                logic: "åŠ¨åŠ›å­¦çš„ç‰¹ä¾‹ï¼ˆa=0ï¼‰ã€‚", 
                formula: "âˆ‘F=0, âˆ‘M=0",
                eng: "æ‘©å¤©å¤§æ¥¼ä¸å€’çš„æ ¸å¿ƒã€‚ç»“æ„å·¥ç¨‹å¸ˆæœ¬è´¨ä¸Šæ˜¯åœ¨è§£è¶…å¤§è§„æ¨¡çš„å¹³è¡¡æ–¹ç¨‹ç»„ã€‚",
                points: ["ç©ºé—´6æ–¹ç¨‹/å¹³é¢3æ–¹ç¨‹", "æ”¯åº§ååŠ›æ±‚è§£"],
                units: [{name:"åŠ›",sym:"F",unit:"N",dim:"MLTâ»Â²"}, {name:"åŠ›çŸ©",sym:"M",unit:"NÂ·m",dim:"MLÂ²Tâ»Â²"}],
                funFact: "6ä¸ªå¹³è¡¡æ–¹ç¨‹å¯¹åº”åˆšä½“åœ¨ç©ºé—´çš„6ä¸ªè‡ªç”±åº¦ï¼ˆ3ç§»+3è½¬ï¼‰ã€‚"
            },
            // è¿åŠ¨å­¦
            { id: "ç‚¹çš„åˆæˆè¿åŠ¨", group: 2, 
                desc: "ç»å¯¹ = ç‰µè¿ + ç›¸å¯¹ã€‚", 
                logic: "åŠ¨å‚è€ƒç³»é—®é¢˜ã€‚ç‰¢è®° v=rÏ‰ ç­‰çº¿è§’å…³ç³»ã€‚", 
                formula: "v=rÏ‰, a_n=rÏ‰Â²<br>v_a=v_e+v_r",
                eng: "æœºåºŠåŠ å·¥æ§åˆ¶ã€å¯¼å¼¹å‘å°„ï¼ˆç§‘æ°åŠ›ä¿®æ­£ï¼‰ã€ç¦»å¿ƒæ³µæµä½“åˆ†æã€‚",
                points: ["çº¿è§’å…³ç³» v=rÏ‰", "ä¸‰ç§è¿åŠ¨å®šä¹‰", "ç§‘æ°åŠ é€Ÿåº¦æ–¹å‘"],
                units: [{name:"è§’é€Ÿåº¦",sym:"Ï‰",unit:"rad/s",dim:"Tâ»Â¹"}, {name:"çº¿é€Ÿåº¦",sym:"v",unit:"m/s",dim:"LTâ»Â¹"}],
                funFact: "ä¸ºä»€ä¹ˆæ²¡æœ‰æ³•å‘é€Ÿåº¦æ–¹ç¨‹ï¼Ÿå› ä¸ºé€Ÿåº¦æ–¹å‘æ°¸è¿œæ²¿åˆ‡çº¿ï¼Œæ³•å‘åˆ†é‡æ’ä¸º0ã€‚"
            },
            { id: "åˆšä½“å¹³é¢è¿åŠ¨", group: 2, 
                desc: "å¹³åŠ¨ + è½¬åŠ¨ã€‚ç¬å¿ƒæ³•/åŸºç‚¹æ³•ã€‚", 
                logic: "åˆ†è§£ä¸ºéšè´¨å¿ƒå¹³ç§»+ç»•è´¨å¿ƒè½¬åŠ¨ã€‚åŠ¨åŠ›å­¦åˆ†æçš„å‰æã€‚", 
                formula: "v_B=v_A+v_BA<br>v_BA=Ï‰Ã—r_AB",
                eng: "å‘åŠ¨æœºæ›²æŸ„è¿æ†æœºæ„è®¾è®¡ï¼›æ±½è½¦ä¾§ç¿»ç¨³å®šæ€§ä¸è´¨å¿ƒé«˜åº¦çš„å…³ç³»ã€‚",
                points: ["è´¨å¿ƒä½ç½®è®¡ç®—", "åŸºç‚¹æ³•çŸ¢é‡å åŠ ", "ç¬å¿ƒæ³•(IC)"],
                units: [{name:"è§’é€Ÿåº¦",sym:"Ï‰",unit:"rad/s",dim:"Tâ»Â¹"}],
                funFact: "é€Ÿåº¦ç¬å¿ƒçš„é€Ÿåº¦ä¸º0ï¼Œä½†åŠ é€Ÿåº¦é€šå¸¸ä¸ä¸º0ï¼è¿™æ˜¯æœ€å¤§çš„é™·é˜±ã€‚"
            },
            // åŠ¨åŠ›å­¦
            { id: "åŠ¨é‡å®šç†", group: 3, 
                desc: "F=ma å¯¹æ—¶é—´ t çš„ç§¯åˆ†ã€‚", 
                logic: "è®¡ç®—å¹³åŠ¨åŠ¨é‡ã€‚åŠ¨é‡å®ˆæ’æ˜¯æ·å¾„ã€‚", 
                formula: "I=âˆ«Fdt=Î”mv",
                eng: "æµä½“å†²å‡»åŠ›è®¡ç®—ï¼›æ±½è½¦å®‰å…¨æ°”å›Šï¼ˆå»¶é•¿dtå‡å°Fï¼‰ï¼›ç«ç®­æ¨è¿›ã€‚",
                points: ["ç³»ç»ŸåŠ¨é‡å®ˆæ’", "è´¨å¿ƒè¿åŠ¨å®šç†", "å†²é‡è®¡ç®—"],
                units: [{name:"åŠ¨é‡",sym:"P",unit:"kgÂ·m/s",dim:"MLTâ»Â¹"}, {name:"å†²é‡",sym:"I",unit:"NÂ·s",dim:"MLTâ»Â¹"}],
                funFact: "å³ä½¿åœ¨çœŸç©ºï¼Œç«ç®­ä¹Ÿèƒ½é åŠ¨é‡å®šç†é£è¡Œï¼ˆåå‘æŠ›å‡ºè´¨é‡ï¼‰ã€‚"
            },
            { id: "åŠ¨é‡çŸ©å®šç†", group: 3, 
                desc: "r Ã— F å¯¹æ—¶é—´ t çš„ç§¯åˆ†ã€‚", 
                logic: "è½¬åŠ¨é—®é¢˜çš„æ ¸å¿ƒã€‚M=JÎ±ã€‚", 
                formula: "M_z=J_zÂ·Î±<br>L_z=J_zÂ·Ï‰",
                eng: "é£è½®å‚¨èƒ½ï¼›å«æ˜Ÿå§¿æ€æ§åˆ¶ï¼›é™€èºä»ªç¨³å®šåŸç†ã€‚",
                points: ["è½¬åŠ¨æƒ¯é‡Jç‰©ç†æ„ä¹‰", "åŠ¨é‡çŸ©å®ˆæ’"],
                units: [{name:"è½¬åŠ¨æƒ¯é‡",sym:"J",unit:"kgÂ·mÂ²",dim:"MLÂ²"}, {name:"åŠ¨é‡çŸ©",sym:"L",unit:"kgÂ·mÂ²/s",dim:"MLÂ²Tâ»Â¹"}],
                funFact: "ç”¨Jè¡¨ç¤ºæè½¬åŠ¨æƒ¯é‡æ˜¯ä¸ºäº†åŒºåˆ«äºæˆªé¢æƒ¯æ€§çŸ©Iã€‚ç¦»è½´è¶Šè¿œï¼ŒJè¶Šå¤§ï¼Œè¶Šéš¾è½¬ã€‚"
            },
            { id: "åŠ¨èƒ½å®šç†", group: 3, 
                desc: "F=ma å¯¹ä½ç§» s çš„ç§¯åˆ†ã€‚", 
                logic: "èƒ½é‡æ³•ï¼ˆæ ‡é‡ï¼‰ï¼Œé¿å¼€å¤æ‚çš„çŸ¢é‡åˆ†æã€‚", 
                formula: "W=Tâ‚‚-Tâ‚<br>T=Â½mvÂ²+Â½JÏ‰Â²",
                eng: "ç”µæœºåŠŸç‡é€‰å‹ï¼›åˆ¹è½¦è·ç¦»è®¡ç®—ï¼›æœºæ¢°æ•ˆç‡åˆ†æã€‚",
                points: ["ç†æƒ³çº¦æŸä¸åšåŠŸ", "å†…åŠ›åšåŠŸ", "ç»¼åˆåº”ç”¨"],
                units: [{name:"åŠŸ",sym:"W",unit:"J",dim:"MLÂ²Tâ»Â²"}, {name:"åŠ¨èƒ½",sym:"T",unit:"J",dim:"MLÂ²Tâ»Â²"}],
                funFact: "ç”¨Tè¡¨ç¤ºåŠ¨é‡å¯èƒ½æºäºæ³•è¯­ Travail (å·¥ä½œ)ã€‚èƒ½é‡æ³•æ˜¯æ ‡é‡ï¼Œè®¡ç®—æ¯”çŸ¢é‡æ³•ä¼˜é›…ã€‚"
            },
            { id: "è¾¾æœ—è´å°”åŸç†", group: 3, 
                desc: "å¼•å…¥æƒ¯æ€§åŠ›ï¼ŒåŒ–åŠ¨ä¸ºé™ã€‚", 
                logic: "ç”¨é™åŠ›å­¦æ–¹ç¨‹è§£åŠ¨åŠ›å­¦é—®é¢˜ã€‚", 
                formula: "F+F_N+F_I=0<br>F_I=-ma",
                eng: "è½¬å­åŠ¨å¹³è¡¡ï¼›é«˜é€Ÿæ„ä»¶åŠ¨åº”åŠ›åˆ†æï¼›æŠ—éœ‡ç»“æ„è®¾è®¡ã€‚",
                points: ["æƒ¯æ€§åŠ›æ˜¯è™šæ‹ŸåŠ›", "æƒ¯æ€§åŠ›ç³»ç®€åŒ–", "åŠ¨é™æ³•"],
                units: [{name:"æƒ¯æ€§åŠ›",sym:"F_I",unit:"N",dim:"MLTâ»Â²"}],
                funFact: "è¾¾æœ—è´å°”åˆ©ç”¨æƒ¯æ€§åŠ›æŠŠæ—¶é—´å†»ç»“ï¼Œå°†å¤æ‚çš„åŠ¨åŠ›å­¦å˜æˆäº†é™åŠ›å­¦å¹³è¡¡é—®é¢˜ã€‚"
            }
        ],
        links: [
            { source: "å—åŠ›åˆ†æ (FBD)", target: "é™åŠ›å­¦å¹³è¡¡æ–¹ç¨‹" },
            { source: "å—åŠ›åˆ†æ (FBD)", target: "åŠ›ç³»ç®€åŒ–" },
            { source: "åŠ›ç³»ç®€åŒ–", target: "é™åŠ›å­¦å¹³è¡¡æ–¹ç¨‹" },
            { source: "åŠ›ç³»ç®€åŒ–", target: "åˆšä½“å¹³é¢è¿åŠ¨", type: "synthesis" },
            { source: "åˆšä½“å¹³é¢è¿åŠ¨", target: "ç‰›é¡¿ç¬¬äºŒå®šå¾‹ (F=ma)", type: "synthesis" },
            { source: "ç‰›é¡¿ç¬¬äºŒå®šå¾‹ (F=ma)", target: "åŠ›ç³»ç®€åŒ–", type: "synthesis" }, 
            { source: "ç‚¹çš„åˆæˆè¿åŠ¨", target: "åˆšä½“å¹³é¢è¿åŠ¨" },
            { source: "ç‰›é¡¿ç¬¬äºŒå®šå¾‹ (F=ma)", target: "åŠ¨é‡å®šç†", type: "derive" },
            { source: "ç‰›é¡¿ç¬¬äºŒå®šå¾‹ (F=ma)", target: "åŠ¨é‡çŸ©å®šç†", type: "derive" },
            { source: "ç‰›é¡¿ç¬¬äºŒå®šå¾‹ (F=ma)", target: "åŠ¨èƒ½å®šç†", type: "derive" },
            { source: "ç‰›é¡¿ç¬¬äºŒå®šå¾‹ (F=ma)", target: "è¾¾æœ—è´å°”åŸç†", type: "derive" },
            { source: "åŠ›ç³»ç®€åŒ–", target: "è¾¾æœ—è´å°”åŸç†" },
            { source: "åˆšä½“å¹³é¢è¿åŠ¨", target: "åŠ¨é‡çŸ©å®šç†" }, 
            { source: "åˆšä½“å¹³é¢è¿åŠ¨", target: "åŠ¨èƒ½å®šç†" }, 
            { source: "åŠ¨é‡å®šç†", target: "åˆšä½“å¹³é¢è¿åŠ¨" },
            { source: "é™åŠ›å­¦å¹³è¡¡æ–¹ç¨‹", target: "è¾¾æœ—è´å°”åŸç†" }
        ]
    };

    // --- åˆå§‹åŒ– D3 ---
    const container = document.getElementById('graph-container');
    const width = container.clientWidth;
    const height = container.clientHeight;
    
    const colorScale = d3.scaleOrdinal()
        .domain([0, 1, 2, 3])
        .range(["#d32f2f", "#f57c00", "#1976d2", "#388e3c"]);

    const svg = d3.select("#graph-container").append("svg")
        .attr("width", "100%")
        .attr("height", "100%")
        .attr("viewBox", [0, 0, width, height])
        .call(d3.zoom().on("zoom", (event) => {
            g.attr("transform", event.transform);
        }));

    const g = svg.append("g");

    // é’ˆå¯¹æ‰‹æœºå±å¹•å‡å°æ–¥åŠ›ï¼Œé˜²æ­¢èŠ‚ç‚¹è·‘å¤ªè¿œ
    const isMobile = window.innerWidth < 768;
    const forceStrength = isMobile ? -1000 : -2000;
    const linkDist = isMobile ? 120 : 220;

    const simulation = d3.forceSimulation(data.nodes)
        .force("link", d3.forceLink(data.links).id(d => d.id).distance(linkDist)) 
        .force("charge", d3.forceManyBody().strength(forceStrength)) 
        .force("center", d3.forceCenter(width / 2, height / 2))
        .force("collide", d3.forceCollide(isMobile ? 50 : 80)); 

    // ç®­å¤´
    svg.append("defs").selectAll("marker")
        .data(["end", "end-bold"])
        .enter().append("marker")
        .attr("id", d => d)
        .attr("viewBox", "0 -5 10 10")
        .attr("refX", isMobile ? 45 : 62) // æ‰‹æœºä¸ŠèŠ‚ç‚¹åŠå¾„å°ï¼ŒrefXä¹Ÿè¦å°
        .attr("refY", 0)
        .attr("markerWidth", 6)
        .attr("markerHeight", 6)
        .attr("orient", "auto")
        .append("path")
        .attr("d", "M0,-5L10,0L0,5")
        .attr("fill", d => d === "end-bold" ? "#7b1fa2" : "#b0bec5");

    const link = g.append("g")
        .selectAll("line")
        .data(data.links)
        .enter().append("line")
        .attr("class", d => d.type === 'derive' ? "link source-Fma" : (d.type === 'synthesis' ? "link synthesis" : "link"))
        .attr("marker-end", d => d.type === 'synthesis' ? "url(#end-bold)" : "url(#end)");

    const node = g.append("g")
        .selectAll("g")
        .data(data.nodes)
        .enter().append("g")
        .attr("class", "node")
        .call(d3.drag()
            .on("start", dragstarted)
            .on("drag", dragged)
            .on("end", dragended));

    node.append("circle")
        .attr("r", isMobile ? 35 : 55) // æ‰‹æœºä¸Šåœ†åœˆå°ä¸€ç‚¹
        .attr("fill", d => colorScale(d.group));

    node.append("text")
        .attr("dy", 5)
        .text(d => {
            const name = d.id.split(" ")[0];
            return name.length > 4 ? name.substring(0,4) + ".." : name;
        }) 
        .style("fill", "#fff")
        .style("font-size", isMobile ? "12px" : "14px");

    // --- ç‚¹å‡»äº¤äº’é€»è¾‘ ---
    node.on("click", (event, d) => {
        event.stopPropagation(); // é˜²æ­¢è§¦å‘èƒŒæ™¯ç‚¹å‡»
        updatePanel(d);
        
        // ç§»åŠ¨ç«¯ï¼šæ»‘å‡ºé¢æ¿
        if (window.innerWidth < 768) {
            document.getElementById("info-panel").classList.add("active");
        }
    });

    // ç‚¹å‡»èƒŒæ™¯å…³é—­é¢æ¿
    svg.on("click", () => {
        closePanel();
    });

    function closePanel() {
        document.getElementById("info-panel").classList.remove("active");
    }

    function updatePanel(d) {
        const details = document.getElementById("details-content");
        const panelInner = document.getElementById("panel-inner");
        
        let groupName = ["æ ¸å¿ƒåŸç†", "é™åŠ›å­¦", "è¿åŠ¨å­¦", "åŠ¨åŠ›å­¦"][d.group];
        let groupColor = colorScale(d.group);

        // æ„å»ºHTML
        let unitsHtml = "";
        if (d.units) {
            unitsHtml = `
            <div class="unit-box">
                <div class="unit-title">ğŸ“ ç‰©ç†é‡ä¸é‡çº² <span class="soul-quote">"Physics without units is just math"</span></div>
                <table class="unit-table">
                    <tr><th>ç‰©ç†é‡</th><th>ç¬¦å·</th><th>å•ä½</th><th>é‡çº²</th></tr>
                    ${d.units.map(u => `<tr><td>${u.name}</td><td><code>${u.sym}</code></td><td>${u.unit}</td><td>${u.dim}</td></tr>`).join('')}
                </table>
            </div>`;
        }

        let funFactHtml = d.funFact ? `<div class="fun-fact-box"><div class="fun-fact-title"><i class="fas fa-lightbulb"></i> FUN FACT</div><div class="fun-fact-content">${d.funFact}</div></div>` : "";

        panelInner.innerHTML = `
            <h3>${d.id} <span class="tag" style="background:${groupColor}">${groupName}</span></h3>
            ${unitsHtml}
            <div class="content-box knowledge-ref">
                <strong>ğŸ“– é‡ç‚¹çŸ¥è¯†</strong>
                <ul class="knowledge-list">${d.points.map(p => `<li>${p}</li>`).join('')}</ul>
            </div>
            <div class="content-box formula-box">
                <span class="formula-title">ğŸ“ æ ¸å¿ƒå…¬å¼</span>
                ${d.formula}
            </div>
            <div class="content-box logic-box">
                <span class="logic-title">âš¡ é€»è¾‘ä¸²è”</span>
                ${d.logic}
            </div>
            <div class="content-box eng-box">
                <span class="eng-title">ğŸ› ï¸ å·¥ç¨‹æ„ä¹‰</span>
                ${d.eng}
            </div>
            ${funFactHtml}
            <div style="height:50px;"></div> <!-- åº•éƒ¨å«é«˜ï¼Œé˜²æ­¢å†…å®¹è¢«é®æŒ¡ -->
        `;
    }

    // D3 ä»¿çœŸä¸æ‹–æ‹½
    simulation.on("tick", () => {
        link
            .attr("x1", d => d.source.x)
            .attr("y1", d => d.source.y)
            .attr("x2", d => d.target.x)
            .attr("y2", d => d.target.y);
        node
            .attr("transform", d => `translate(${d.x},${d.y})`);
    });

    function dragstarted(event, d) {
        if (!event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
    }
    function dragged(event, d) {
        d.fx = event.x;
        d.fy = event.y;
    }
    function dragended(event, d) {
        if (!event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
    }
    window.closePanel = closePanel; // æš´éœ²ç»™å…¨å±€æŒ‰é’®
</script>
</body>
</html>
